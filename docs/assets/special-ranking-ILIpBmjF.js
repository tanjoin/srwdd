import{P as H}from"./papaparse.min-Bjupvl7W.js";let E=[];const h={};function $(n,d){const c=[],t={攻撃力:"攻撃力",防御力:"防御力",照準値:"照準値",運動性:"運動性",HP:"HP",与ダメージ:"与ダメージ"};return n.split("。").filter(l=>l.trim()!=="").forEach(l=>{let o=l,s=!1,r=null;const a=/([^、]+?)装備時、/,i=l.match(a);if(i&&(s=!0,r=i[1].trim(),o=l.replace(a,"")),s&&r!==d)return;const g=/(攻撃力|防御力|照準値|運動性|HP|与ダメージ)(・(攻撃力|防御力|照準値|運動性|HP|与ダメージ))+が([\d.]+)%増加/g;let p;for(;(p=g.exec(o))!==null;){const u=p[0].split("が")[0].split("・"),v=parseFloat(p[p.length-1]);u.forEach(S=>{t[S]&&c.push({stat:t[S],value:v,type:"percentage"})})}const k=/全ての攻撃の与ダメージが([\d.]+)%、(照準値・運動性)が([\d.]+)%増加する/g;let f;for(;(f=k.exec(o))!==null;){const u=parseFloat(f[1]);c.push({stat:"与ダメージ",value:u,type:"percentage"});const v=f[2].split("・"),S=parseFloat(f[3]);v.forEach(P=>{t[P]&&c.push({stat:t[P],value:S,type:"percentage"})})}const m=/(攻撃力|防御力|照準値|運動性|HP|与ダメージ)が([\d.]+)%増加/g;let y;for(;(y=m.exec(o))!==null;){const u=t[y[1]];u&&(c.some(S=>S.stat===u&&S.value===parseFloat(y[2]))||c.push({stat:u,value:parseFloat(y[2]),type:"percentage"}))}const C=/(HP)が([\d.]+)増加する/g;let x;for(;(x=C.exec(o))!==null;){const u=t[x[1]];u&&c.push({stat:u,value:parseFloat(x[2]),type:"absolute"})}}),c}function F(n){const d=JSON.parse(JSON.stringify(n.stats)),c=h[n.id]||{},t={攻撃力:0,防御力:0,照準値:0,運動性:0,HP:0,与ダメージ:0},e={攻撃力:0,防御力:0,照準値:0,運動性:0,HP:0};for(const s in c)if(c[s]){const r=n.specialSkills[s];$(r,n.name).forEach(i=>{i.type==="percentage"?t[i.stat]+=i.value:i.type==="absolute"&&(e[i.stat]+=i.value)})}const l={};return["攻撃力","防御力","照準値","運動性","HP"].forEach(s=>{l[s]={};const r=d[s]||{},a=r.基礎ステータス||0,i=1+(t[s]||0)/100;l[s].基礎ステータス=a,l[s].基本スキル=r.基本スキル||0,l[s].特殊スキル=r.特殊スキル||0,l[s].特殊スキル適用後=Math.round(a*i)-a+(e[s]||0)}),l.与ダメージ={基礎ステータス:0,基本スキル:0,特殊スキル:0,特殊スキル適用後:t.与ダメージ},n.calculatedStats=l,n}function b(){const n=document.querySelector(".ranking-container");n.innerHTML="",n.style.display="flex",n.style.flexWrap="wrap",n.style.justifyContent="center",n.style.gap="20px";const d=E.map(F);["攻撃力","防御力","照準値","運動性","HP","与ダメージ"].forEach(t=>{const e=document.createElement("div");e.className="ranking-table-container";const l=document.createElement("h3");l.textContent=`${t} ランキング`,e.appendChild(l);const o=document.createElement("table");o.className="ranking-table";const s=o.insertRow();s.innerHTML=`<th>順位</th><th>パイロット</th><th>${t} (適用後)</th><th>${t} (特殊スキル適用前)</th><th>${t} (特殊スキル適用)</th>`,[...d].sort((a,i)=>{const g=a.calculatedStats[t]?(a.calculatedStats[t].基礎ステータス||0)+(a.calculatedStats[t].基本スキル||0)+(a.calculatedStats[t].特殊スキル||0)+(a.calculatedStats[t].特殊スキル適用後||0):0,p=i.calculatedStats[t]?(i.calculatedStats[t].基礎ステータス||0)+(i.calculatedStats[t].基本スキル||0)+(i.calculatedStats[t].特殊スキル||0)+(i.calculatedStats[t].特殊スキル適用後||0):0;return t==="与ダメージ"?(i.calculatedStats[t].特殊スキル適用後||0)-(a.calculatedStats[t].特殊スキル適用後||0):p-g}).forEach((a,i)=>{const g=a.calculatedStats[t]?(a.calculatedStats[t].基礎ステータス||0)+(a.calculatedStats[t].基本スキル||0)+(a.calculatedStats[t].特殊スキル||0)+(a.calculatedStats[t].特殊スキル適用後||0):0,p=a.calculatedStats[t]?(a.calculatedStats[t].基礎ステータス||0)+(a.calculatedStats[t].基本スキル||0)+(a.calculatedStats[t].特殊スキル||0):0,k=a.calculatedStats[t]&&a.calculatedStats[t].特殊スキル適用後||0,f=o.insertRow();let m=`+${k}`;t==="与ダメージ"&&(m=`+${k.toFixed(1)}%`),f.innerHTML=`<td>${i+1}</td><td>${a.name}</td><td>${g}</td><td>${p}</td><td>${m}</td>`}),e.appendChild(o),n.appendChild(e)})}function M(n){const d=document.getElementById("pilot-skills");d.innerHTML="",n.forEach(c=>{if(Object.keys(c.specialSkills).length>0){const t=document.createElement("div");t.className="pilot-skill-section";let e=`<h3>${c.name}</h3><ul>`;for(const l in c.specialSkills){const o=h[c.id]&&h[c.id][l];e+=`
          <li>
            <label>
              <input type="checkbox" class="skill-checkbox" data-pilot-id="${c.id}" data-skill-key="${l}" ${o?"checked":""}>
              ${c.specialSkills[l]}
            </label>
          </li>
        `}e+="</ul>",t.innerHTML=e,d.appendChild(t)}}),document.querySelectorAll(".skill-checkbox").forEach(c=>{c.addEventListener("change",t=>{const{pilotId:e,skillKey:l}=t.target.dataset;h[e]||(h[e]={}),h[e][l]=t.target.checked,b()})})}function L(n,d){H.parse(n,{header:!0,dynamicTyping:!0,complete:c=>{const t=c.data.map(e=>{const l={},o={};for(const s in e)if(s.includes("_")){const[r,a]=s.split("_");l[r]||(l[r]={}),l[r][a]=e[s]}else s.startsWith("特殊スキル-")&&e[s]&&(o[s]=e[s]);return{id:e.id,name:e.name,series:e.series,stats:l,specialSkills:o}}).filter(e=>e.id);d(t)}})}window.addEventListener("DOMContentLoaded",async()=>{document.getElementById("csvFileInput").addEventListener("change",d=>{const c=d.target.files[0];c&&L(c,t=>{E=t,E.forEach(e=>{if(Object.keys(e.specialSkills).length>0){h[e.id]={};for(const l in e.specialSkills)h[e.id][l]=!0}}),M(t),b()})})});
